# [Posts]ê²Œì‹œê¸€ ìˆ˜ì •ë° ì‚­ì œ ì œí•œ ê¸°ëŠ¥

### êµ¬í˜„ í™”ë©´

![ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%91%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B3%E1%86%AF%E1%84%8A%E1%85%B3%E1%84%80%E1%85%B5%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB%20dfc81b46584243cc99d56502743755ce/Untitled.png)

ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´

![Untitled](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B5%E1%84%82%E1%85%B3%E1%86%BC%203d034e6ce38c417996d0a6677fb3006c/Untitled.png)

ìƒì„¸ ê²Œì‹œê¸€ í™”ë©´ ( ë³¸ì¸ ê²Œì‹œê¸€ O )

![ìƒì„¸ ê²Œì‹œê¸€ í™”ë©´ ( ë³¸ì¸ ê²Œì‹œê¸€ X )](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B5%E1%84%82%E1%85%B3%E1%86%BC%203d034e6ce38c417996d0a6677fb3006c/Untitled%201.png)

ìƒì„¸ ê²Œì‹œê¸€ í™”ë©´ ( ë³¸ì¸ ê²Œì‹œê¸€ X )

![ê²Œì‹œê¸€ ìˆ˜ì • í˜ì´ì§€](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B5%E1%84%82%E1%85%B3%E1%86%BC%203d034e6ce38c417996d0a6677fb3006c/Untitled%202.png)

ê²Œì‹œê¸€ ìˆ˜ì • í˜ì´ì§€

### **ì ‘ê·¼ ë¡œì§**

1. ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´(index.html )ì—ì„œ 
PostsIndexController ë¥¼ í†µí•´ ê²Œì‹œê¸€ í´ë¦­ìœ¼ë¡œ ìƒì„¸ í˜ì´ì§€(posts-read.html )ì´ë™
(ì´ë•Œ ì»¨íŠ¸ë¡¤ëŸ¬ ì—ì„œ ê²Œì‹œê¸€/ëŒ“ê¸€ ê´€ë ¨ ë³¸ì¸ í™•ì¸í›„ ê²°ê³¼ì— ë”°ë¼ ìƒì„¸ í˜ì´ì§€ ë³€í™”)
2. ìƒì„¸ í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ PostsIndexController ë¥¼ í†µí•´ ìˆ˜ì • ë²„íŠ¼ìœ¼ë¡œ 
ìˆ˜ì • í˜ì´ì§€ (posts-update.html) ì´ë™
3. ìˆ˜ì • í˜ì´ì§€ì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•œ ë’¤ ì™„ë£Œ ë²„íŠ¼ì„  ëˆ„ë¥´ë©´
Footer ì˜ <script src="/js/app.js"></script> ë¥¼ í†µí•´ [app.js](JavaScript%20%E1%84%8B%E1%85%AA%20%E1%84%8B%E1%85%B2%E1%84%92%E1%85%AD%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%80%E1%85%A5%E1%86%B7%E1%84%89%E1%85%A1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(app%20js)%20a7aa307c3044477393d4dd2cf4e80303.md) ì ‘ê·¼
(app.js ì—ëŠ” í´ë¦­ ì´ë²¤íŠ¸ ë©”ì„œë“œì™€ ìœ íš¨ì„± ê²€ì‚¬ ë° ì´ë™ì£¼ì†Œ ì„¤ì •)
    
    ![Untitled](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B5%E1%84%82%E1%85%B3%E1%86%BC%203d034e6ce38c417996d0a6677fb3006c/Untitled%203.png)
    
4. PostsIndexController ë¥¼ í†µí•´ ê¸€ ìˆ˜ì •

---

### posts/posts-read.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div th:replace="~{layout/header :: header}"></div>
<br/>
<div id="posts_list" class="col-md-12">
    <form class="card">
        <div class="card-header d-flex justify-content-between">
            <label for="id">ë²ˆí˜¸ : [[${posts.id}]]</label>
            <input type="hidden" id="id" th:value="${posts.id}"> <!-- label ì—°ê²° -->
            <label for="content">[[${posts.createDate}]]</label>
        </div>
        <div class="card-header d-flex justify-content-between">
            <label for="content">ì‘ì„±ì :[[${posts.writer}]] </label>
            <label for="content"><i class=" bi bi-eye-fill"> [[${posts.view}]] </i></label>
        </div>
        <div class="card-body">
            <label for="title">ì œëª©</label>
            <input type="text" class="form-control" id="title" th:value="${posts.title}" readonly>
            <br/>
            <label for="content">ë‚´ìš©</label>
            <textarea rows="5" class="form-control" id="content" readonly th:text="${posts.content}"></textarea>
        </div>
    </form>

    <!-- Buttons -->
    <div th:if="${user}">
        <a href="/" role="button" class="btn btn-info bi bi-arrow-return-left"> ëª©ë¡</a>
        <span th:if="${writer}">
            <a th:href="@{/posts/update/{id}(id=${posts.id})}" role="button" class="btn btn-primary bi bi-pencil-square"> ìˆ˜ì •</a>
            <button type="button" onclick="" id="btn-delete" class="btn btn-danger bi bi-trash"> ì‚­ì œ</button>
        </span>
    </div>
    <div th:unless="${user}">
        <a href="/" role="button" class="btn btn-info bi bi-arrow-return-left"> ëª©ë¡</a>
    </div>

    <!-- Comments -->
    <div th:replace="~{comment/list :: list}"></div>
    <div th:replace="~{comment/form :: form}"></div>
</div>
<div th:replace="~{layout/footer :: footer}"></div>

</html>
```

### posts/posts-update.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{layout/header :: header}"></div>

<div id="posts_list" class="col-md-12">
    <form class="card">
        <div class="card-header d-flex justify-content-between">
            <label th:for="id">ë²ˆí˜¸ : [[${posts.id}]] </label>
            <input type="hidden" id="id" th:value="${posts.id}"> <!-- label ì—°ê²° -->
            <label th:for="createDate">[[${posts.createDate}]]</label>
        </div>
        <div class="card-header d-flex justify-content-between">
            <label th:for="writer">ì‘ì„±ì : [[${posts.writer}]] </label>
            <label th:for="view"><i class=" bi bi-eye-fill"> [[${posts.view}]]</i></label>
        </div>
        <div class="card-body">
            <label th:for="title">ì œëª©</label>
            <input type="text" class="form-control" id="title" th:value="${posts.title}">
        </div>

        <div class="card-body">
            <label th:for="content">ë‚´ìš©</label>
            <textarea rows="5" class="form-control" id="content" th:text="${posts.content}"></textarea>
        </div>
    </form>

    <!-- ë²„íŠ¼ -->
    <a th:href="@{/posts/read/{id}(id=${posts.id})}" role="button" class="btn btn-info bi bi-arrow-return-left"> ì·¨ì†Œ</a>
    <button type="button" id="btn-update" class="btn btn-primary bi bi-pencil-square"> ì™„ë£Œ</button>
</div>

<!-- í‘¸í„° í¬í•¨ -->
<div th:replace="~{layout/footer :: footer}"></div>
</html>

```

---

### PostsIndexController.java

ê²Œì‹œê¸€ ê´€ë ¨ í™”ë©´ ì—°ê²° ì»¨íŠ¸ë¡¤ëŸ¬

```java
@Slf4j
@RequiredArgsConstructor
@Controller
public class PostsIndexController {
    private final PostsService postsService;
    
     /* ê¸€ ìƒì„¸ë³´ê¸° */
    @GetMapping("/posts/read/{id}")
    public String read(@PathVariable("id") Long id, @LoginUser UserDto.Response user, Model model) {
        PostsDto.Response dto = postsService.findById(id);
        List<CommentDto.Response> comments = dto.getComments();

        /* ëŒ“ê¸€ ê´€ë ¨ */
        if (comments != null && !comments.isEmpty()) {
            model.addAttribute("comments", comments);
        }
        /* ì‚¬ìš©ì ê´€ë ¨ */
        if (user != null) {
            model.addAttribute("user", user);

            /* ê²Œì‹œê¸€ ì‘ì„±ì ë³¸ì¸ì¸ì§€ í™•ì¸ */
            if (dto.getUserId().equals(user.getId())) {
                model.addAttribute("writer", true);
            }

            /* ëŒ“ê¸€ ì‘ì„±ì ë³¸ì¸ì¸ì§€ í™•ì¸ */
            if (comments.stream().anyMatch(s -> s.getUserId().equals(user.getId()))) {
                model.addAttribute("isWriter", true);

            }
        }

        postsService.updateView(id); // views ++
        model.addAttribute("posts", dto);

        /* í˜„ì¬ ì„¸ì…˜ì˜ Userid ì „ë‹¬ _ ëŒ“ê¸€ ì‚­ì œ */
        model.addAttribute("sessionId", user.getId());
        return "posts/posts-read";
    }
		/*í•´ë‹¹ ê²Œì‹œë¬¼ ìˆ˜ì •*/

    @GetMapping("/posts/update/{id}")
    public String update(@PathVariable("id") Long id, @LoginUser UserDto.Response user, Model model) {
        PostsDto.Response dto = postsService.findById(id);
        if (user != null) {
            model.addAttribute("user", user);
        }
        model.addAttribute("posts", dto);
        return "posts/posts-update";
    }
    ...
}
```

- `read()`
: ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°ê¸°ëŠ¥ì— ê´€í•œ ë©”ì„œë“œë¡œ ê²½ë¡œ ë³€ìˆ˜ë¡œ ë°›ì€ idë¥¼ í†µí•´ êµ¬í•œ PostsDto ë¥¼ í†µí•´ ëŒ“ê¸€ ì •ë³´(`Comments`)ë¥¼ ë°›ì•„ì˜¨ ë’¤ **Stream** ì„ í†µí•´ ëŒ“ê¸€ ì‘ì„±ì ë¥¼ ë¹„êµí•œë’¤ ì¡°íšŒìˆ˜ ì²˜ë¦¬í›„
ì‚¬ìš©ìì™€ ê²Œì‹œë¬¼ ì •ë³´ ë¥¼ ë„£ì–´ì¤€ë’¤ ë¦¬í„´.
    
    > ì´ë•Œ ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ì˜ ì‘ì„±ìê°€ ë³¸ì¸ì¸ì§€ë¥¼ í™•ì¸í•˜ì—¬ boolean ê°’ì„ ë„˜ê²¨ì£¼ê³  ë³¸ì¸ì´ ì•„ë‹ê²½ìš° posts-read.html ì—ì„œ ì•„ì— í‘œì‹œê°€ ë˜ì§€ ì•Šë„ë¡ ì„¤ê³„
    > 
    > 
    > ![Untitled](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B5%E1%84%82%E1%85%B3%E1%86%BC%203d034e6ce38c417996d0a6677fb3006c/Untitled%204.png)
    > 

<aside>
ğŸ’¡ **ìŠ¤íŠ¸ë¦¼ê³¼ ëŒë‹¤ í‘œí˜„ì‹
`~.stream().anyMatch()`**
Java Stream APIì˜ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œ ìŠ¤íŠ¸ë¦¼ ë‚´ì˜ ìš”ì†Œ ì¤‘ í•˜ë‚˜ë¼ë„ ì£¼ì–´ì§„ ì¡°ê±´(predicate)ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©í•œë‹¤.

**`(parameters) -> expression`**
Java 8 ë„ì…ëœ ìµëª…í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ê°„ê²°í•œ ë°©ë²•.

</aside>

- `update()`
ê²½ë¡œë³€ìˆ˜ë¡œ ë°›ì•„ì˜¨ id ê°’ìœ¼ë¡œ ê²Œì‹œê¸€ì„ ì°¾ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ê²Œì‹œê¸€ ìˆ˜ì • í™”ë©´ì— ë„˜ê²¨ì¤Œ

### PostsApiController.java

ê²Œì‹œê¸€ ê´€ë ¨ ì‹¤ì œ API ê´€ë ¨ ì»¨íŠ¸ë¡¤ëŸ¬

```java
@RequestMapping("/api")
@RequiredArgsConstructor
@RestController
public class PostsApiController {
    private final PostsService postsService;
    
		...
		
    /* UPDATE */
    @PutMapping("/posts/{id}")
    public ResponseEntity update(@PathVariable("id") Long id, @RequestBody PostsDto.Request dto) {
        postsService.update(id, dto);
        return ResponseEntity.ok(id);
    }

    /* DELETE */
    @DeleteMapping("/posts/{id}")
    public ResponseEntity delete(@PathVariable("id") Long id) {
        postsService.delete(id);
        return ResponseEntity.ok(id);
    }
}
```

---

### PostsService.java

```java
@Slf4j
@RequiredArgsConstructor
@Service
public class PostsService {
    private final PostsRepository postsRepository;
    private final UserRepository userRepository;
    ...

   /* UPDATE (dirty checking ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)
	  * User ê°ì²´ë¥¼ ì˜ì†í™”ì‹œí‚¤ê³ , ì˜ì†í™”ëœ User ê°ì²´ë¥¼ ê°€ì ¸ì™€ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë©´
	  * íŠ¸ëœì­ì…˜ì´ ëë‚  ë•Œ ìë™ìœ¼ë¡œ DBì— ì €ì¥
	  */
    @Transactional
    public void update(Long id, PostsDto.Request dto) {
        Posts posts = postsRepository.findById(id).orElseThrow(() ->
                new IllegalArgumentException("í•´ë‹¹ ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id=" + id));
        posts.update(dto.getTitle(), dto.getContent());
    }

    /* DELETE */
    @Transactional
    public void delete(Long id) {
        Posts posts = postsRepository.findById(id).orElseThrow(() ->
                new IllegalArgumentException("í•´ë‹¹ ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id=" + id));
        postsRepository.delete(posts);
    }
    
    ...
 }
```

- `update()`
`@Transactional` ì´ ë¶™ì–´ ìˆëŠ” ë©”ì„œë“œê°€ í˜¸ì¶œ ë˜ë©´ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ ë˜ë©°
JPA ì˜ EntityManager ì— ì˜í•´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ í•œë‹¤.  ì´ë ‡ê²Œ ë˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì•ˆì— ê´€ë¦¬ ë˜ëŠ” Posts ì—”í‹°í‹°ì˜ ìƒíƒœ ê°’ì´ ë³€ê²½ë˜ë©´ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€.

---