# [Posts]ê²Œì‹œíŒ ê¸€ì“°ê¸° ê´€ë ¨

### êµ¬í˜„ í™”ë©´

ë¡œê·¸ì¸ì„ ì„±ê³µ í•œë’¤ ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ì—¬ ì •ë³´ì™€ í•¨ê»˜ ì €ì¥

![ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%91%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B3%E1%86%AF%E1%84%8A%E1%85%B3%E1%84%80%E1%85%B5%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB%20dfc81b46584243cc99d56502743755ce/Untitled.png)

ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´

![ê²Œì‹œê¸€ ì‘ì„± í™”ë©´](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%91%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B3%E1%86%AF%E1%84%8A%E1%85%B3%E1%84%80%E1%85%B5%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB%20dfc81b46584243cc99d56502743755ce/Untitled%201.png)

ê²Œì‹œê¸€ ì‘ì„± í™”ë©´

### **ì ‘ê·¼ ë¡œì§**

1. PostsIndexController ë¥¼ í†µí•´ ë„ì–´ì¤€ ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´ì—ì„œ ê¸€ì“°ê¸° ë²„íŠ¼
2. ê¸€ì“°ê¸° í™”ë©´ì— PostsIndexController ë¥¼ í†µí•´ íšŒì› ì •ë³´ ë°›ì•„ì˜¤ê³ 
3. Footer ì˜ <script src="/js/app.js"></script> ë¥¼ í†µí•´ [app.js](JavaScript%20%E1%84%8B%E1%85%AA%20%E1%84%8B%E1%85%B2%E1%84%92%E1%85%AD%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%80%E1%85%A5%E1%86%B7%E1%84%89%E1%85%A1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(app%20js)%20a7aa307c3044477393d4dd2cf4e80303.md) ì ‘ê·¼
4. app.js ì—ì„œ í´ë¦­ ì´ë²¤íŠ¸ ë©”ì„œë“œë¥¼ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ì™€ ì´ë™ì£¼ì†Œ ì„¤ì •
    
    ![Untitled](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%91%E1%85%A1%E1%86%AB%20%E1%84%80%E1%85%B3%E1%86%AF%E1%84%8A%E1%85%B3%E1%84%80%E1%85%B5%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB%20dfc81b46584243cc99d56502743755ce/Untitled%202.png)
    
5. PostsApiController ë¥¼ í†µí•´ ê²Œì‹œê¸€ ì‘ì„±

---

### posts/index.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div th:replace="~{layout/header :: header}"></div>

<div id="posts_list">
    <table id="table" class="table table-horizontal">
        <thead id="thead">
        <tr>
            <th>ë²ˆí˜¸</th>
            <th class="col-md-6 text-center">ì œëª©</th>
            <th>ì‘ì„±ì</th>
            <th>ì‘ì„±ì¼</th>
            <th>ì¡°íšŒìˆ˜</th>
        </tr>
        </thead>
        <tbody id="tbody">
        <tr th:each="post : ${posts}">
            <td th:text="${post.id}"></td>
            <td><a th:href="@{/posts/read/{id}(id=${post.id})}" th:text="${post.title}"></a></td>
            <td th:text="${post.writer}"></td>
            <td th:text="${post.createdDate}"></td>
            <td th:text="${post.view}"></td>
        </tr>
        </tbody>
    </table>
    <div class="text-right">
        <a href="/posts/write" role="button" class="btn btn-primary bi bi-pencil-fill"> ê¸€ì“°ê¸°</a>
    </div>
    <!-- Page -->
    <div th:replace="~{posts/posts-page :: posts-page}"></div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>
</body>
</html>

```

### posts/posts-write.html

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{layout/header :: header}"></div>

<div id="posts_list" class="container col-md-8">
    <form>
        <div class="form-group">
            <label for="title">ì œëª©</label>
            <input type="text" class="form-control" id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <input type="hidden" class="form-control" id="writer" th:value="${user.nickname}">
        <div class="form-group">
            <label for="content">ë‚´ìš©</label>
            <textarea rows="10" class="form-control" id="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
    </form>
    <button type="button" id="btn-save" class="btn btn-primary bi bi-pencil-fill"> ì‘ì„±</button>
    <a href="/" role="button" class="btn btn-info bi bi-arrow-return-left"> ëª©ë¡</a>
</div>

<!-- í‘¸í„° í¬í•¨ -->
<div th:replace="~{layout/footer :: footer}"></div>
</body>
</html>

```

---

### PostsIndexController.java

ê²Œì‹œê¸€ ê´€ë ¨ í™”ë©´ ì—°ê²° ì»¨íŠ¸ë¡¤ëŸ¬

```java
@Slf4j
@RequiredArgsConstructor
@Controller
public class PostsIndexController {
    private final PostsService postsService;

    @GetMapping("/")
    public String index(Model model, @PageableDefault(sort = "id", direction = Sort.Direction.DESC)
                        Pageable pageable, @LoginUser UserDto.Response user) {
        Page<Posts> list = postsService.pageList(pageable);

        if (user != null) {
            model.addAttribute("user", user);
        }
        model.addAttribute("posts", list);
        model.addAttribute("previous", pageable.previousOrFirst().getPageNumber());
        model.addAttribute("next", pageable.next().getPageNumber());
        model.addAttribute("hasNext", list.hasNext());
        model.addAttribute("hasPrev", list.hasPrevious());

        return "index";
    }

    /* ê¸€ ì‘ì„± */
    @GetMapping("/posts/write")
    public String write(@LoginUser UserDto.Response user, Model model) {
        if (user != null) {
            model.addAttribute("user", user);
        }
        return "posts/posts-write";
    }
}
```

- `index()` 
: ë§¨ ì²˜ìŒ ê²Œì‹œê¸€ ëª©ë¡ ì •ë³´ë¥¼ ë°›ì•„ì™€ â€œ/â€ì£¼ì†Œì˜ ì°½ ì¶œë ¥ í•´ì£¼ëŠ” ì—­í• ì„ í•´ì¤€ë‹¤.
    - `@LoginUser UserDto.Response user`
    : ì„¸ì…˜ê³¼ ê´€ë ¨í•˜ì—¬ ìƒì„±í•œ [Annotation](%E1%84%8B%E1%85%A6%E1%86%AB%E1%84%90%E1%85%B5%E1%84%90%E1%85%B5%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB%20DTO%20e4796b1ecaac44c5b495db7268744b97.md) ì´ìš©
    
    > `@PageableDefault` / `Page` ê´€í•´ì„œëŠ” ë’¤ì˜ [í˜ì´ì§• ê¸°ëŠ¥](%5BPosts%5D%E1%84%80%E1%85%A6%E1%84%89%E1%85%B5%E1%84%91%E1%85%A1%E1%86%AB%20%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8C%E1%85%B5%E1%86%BC%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB%20aea9acce7bfe4d0ca271e1c244c2870f.md)ì—ì„œ ì–¸ê¸‰
    > 
    
- `write()` : ê²Œì‹œê¸€ ì‘ì„± í™”ë©´ì— ì‚¬ìš©ì ì •ë³´ ì¶œë ¥ ì—­í• 

### PostsApiController.java

ê²Œì‹œê¸€ ê´€ë ¨ ì‹¤ì œ API ê´€ë ¨ ì»¨íŠ¸ë¡¤ëŸ¬

```java
@RequestMapping("/api")
@RequiredArgsConstructor
@RestController
public class PostsApiController {
    private final PostsService postsService;

    /* CREATE */
    @PostMapping("/posts")
    public ResponseEntity save(@RequestBody PostsDto.Request dto, @LoginUser UserDto.Response user) {
        return ResponseEntity.ok(postsService.save(dto, user.getNickname()));
    }
}
```

- `save()` 
: ê²Œì‹œê¸€ê³¼ ì‚¬ìš©ì ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì™€ ì‘ì„±í•´ì£¼ëŠ” APIì—­í•  í•´ì¤€ë‹¤.
    - `@RequestBody`
    : í´ë¼ì´ì–¸íŠ¸ê°€ ì „ì†¡í•œ HTTP Request ì˜ bodyë¥¼ ìë°” ê°ì²´ë¡œ ë³€í™˜í•´ì£¼ëŠ” ì—­í• 
    (HTTP ë©”ì‹œì§€ ë°”ë””ë¥¼ ì§ì ‘ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥)
    - `ResponseEntity.ok()`
    : Spring Frameworkì—ì„œ HTTP ì‘ë‹µì„ ìƒì„±í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ë©”ì„œë“œë¡œ ê´„í˜¸ ì•ˆì—ëŠ”
    HTTP ìƒíƒœ ì½”ë“œ / header / body / .. ë“±ì„ í¬í•¨ í•  ìˆ˜ ìˆê³  
    ê´„í˜¸ì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ í¬í•¨í•œ HTTP 200 ok ìƒíƒœ ì½”ë“œë¥¼ returní•œë‹¤.

<aside>
ğŸ’¡ `PostsDto`ëŠ” **Request** ì¸ ë°˜ë©´ ****`UserDto` ëŠ” **Response** ?

PostsApiController ëŠ” ì£¼ë¡œ ê²Œì‹œê¸€(Posts)ì— ê´€ë ¨ ëœ ì²˜ë¦¬ ê³¼ì •ì´ê¸° ë•Œë¬¸ì— 
ê°™ì€ Posts dataì™€ ê´€ë ¨í•´ì„œëŠ” ì²˜ë¦¬í›„ ì„œë²„ë¡œ ë„˜ê²¨ì¤˜ `PostsDto` ì˜ **Requestì ‘ê·¼ì¸ ë°˜ë©´**,
****User dataëŠ” ì„œë²„ì—ì„œ dataë¥¼ ê°€ì ¸ì™€ `UserDto` ê¸°ì¤€ **Response** ì ‘ê·¼ì„ í•œ ê²ƒìœ¼ë¡œ ì¶”ë¡ 

</aside>

---

### PostsService.java

ì´ë¦„ìœ¼ë¡œ Userê°ì²´ë¥¼ ì°¾ì•„ ê²Œì‹œë¬¼(Posts) Dto ì˜ ì—”í‹°í‹°ë¡œ ë°”ê¿”ì¤€ë’¤ Repository ì—ì„œ ì—”í‹°í‹° ì €ì¥

```java
@Slf4j
@RequiredArgsConstructor
@Service
public class PostsService {
    private final PostsRepository postsRepository;
    private final UserRepository userRepository;

    /* CREATE */
    @Transactional
    public Long save(PostsDto.Request dto, String nickname) {
        /* User ì •ë³´ë¥¼ ê°€ì ¸ì™€ dtoì— ë‹´ì•„ì¤€ë‹¤. */
        User user = userRepository.findByNickname(nickname);
        dto.setUser(user);
        log.info("PostsService save() ì‹¤í–‰");
        Posts posts = dto.toEntity();
        postsRepository.save(posts);

        return posts.getId();
    }
    ...
 }
```

> ì´ë•Œ postsRepository ì˜ `save()` ëŠ” ìƒì†ë°›ì€ JpaRepository ì˜ `save()`
> 

---