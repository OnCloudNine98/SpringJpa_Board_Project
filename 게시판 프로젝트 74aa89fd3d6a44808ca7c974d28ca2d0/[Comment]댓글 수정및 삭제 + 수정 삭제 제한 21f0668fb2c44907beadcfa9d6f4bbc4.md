# [Comment]ëŒ“ê¸€ ìˆ˜ì •ë° ì‚­ì œ + ìˆ˜ì •/ì‚­ì œ ì œí•œ ê¸°ëŠ¥

### êµ¬í˜„ í™”ë©´

ë¡œê·¸ì¸ì„ ì„±ê³µ í•œë’¤ ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ì—¬ ì •ë³´ì™€ í•¨ê»˜ ì €ì¥

![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled.png)

![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%201.png)

![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%202.png)

![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%203.png)

![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%204.png)

### **ë¡œì§**

> ìˆ˜ì •ê³¼ ì‚­ì œëŠ” ì²˜ìŒ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€(posts/posts-read.html) ì˜ 
**í…œí”Œë¦¿ ì¡°ê°**ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€(comment/list.html) ë¥¼ ë„ìš¸ ë•Œ
ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° Controller ì—ì„œ model attribute ì„ í†µí•´ ë„˜ê²¨ì¤€ ì‘ì„±ì ì •ë³´(`â€writerâ€`)
ì— ë”°ë¼ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ì´ ë³´ì´ë„ë¡ íƒ€ì„ë¦¬í”„ `th:if="${isWriter}"` ë¥¼ ì´ìš©í•˜ì—¬ ì ‘ê·¼
> 

**ìˆ˜ì •**

1. ëŒ“ê¸€ ì¡°íšŒ ë¡œì§ì„ í†µí•´ ë„ì–´ì¤€ ëŒ“ê¸€ ëª©ë¡ ë¦¬ìŠ¤íŠ¸ì˜ **ì—°í•„ í‘œì‹œ ë²„íŠ¼(ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼)** í´ë¦­
2. Bootstrap ì˜ `collapse` ê¸°ëŠ¥ì„ í†µí•´ `<p>` ë¥¼ `<form>` íƒœê·¸ë¡œ ì „í™˜ë˜ë©´ 
ìˆ˜ì •í•  ëŒ“ê¸€ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ìˆ˜ì • ë²„íŠ¼ì„ í´ë¦­
3. Footer ì˜ `<script src="/js/app.js">`</script> ë¥¼ í†µí•´ [app.js](JavaScript%20%E1%84%8B%E1%85%AA%20%E1%84%8B%E1%85%B2%E1%84%92%E1%85%AD%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%80%E1%85%A5%E1%86%B7%E1%84%89%E1%85%A1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(app%20js)%20a7aa307c3044477393d4dd2cf4e80303.md) ì ‘ê·¼í•˜ê³ 
[app.js](JavaScript%20%E1%84%8B%E1%85%AA%20%E1%84%8B%E1%85%B2%E1%84%92%E1%85%AD%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%80%E1%85%A5%E1%86%B7%E1%84%89%E1%85%A1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(app%20js)%20a7aa307c3044477393d4dd2cf4e80303.md) ì˜ í´ë¦­ ì´ë²¤íŠ¸ ë©”ì„œë“œë¥¼ í†µí•´ ìœ íš¨ì„±/ê³µë°± ê²€ì‚¬ í›„ data ì„¤ì •ëœ ì´ë™ ì£¼ì†Œë¡œ ì „ì†¡
    
    ![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%205.png)
    
4.  CommentApiController ì—ì„œ í•´ë‹¹ ì£¼ì†Œë¡œ ë§¤í•‘ëœ ë©”ì„œë“œê°€ ì‹¤í–‰ ë˜ì–´ 
CommentService ì˜ ë©”ì„œë“œ í˜¸ì¶œ
5. CommentService ì—ì„œëŠ” CommentRepository ë¥¼ í†µí•´ ë°›ì•„ì˜¨ ì •ë³´ë¥¼ 
Comment ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ [ë©”ì„œë“œ](%E1%84%83%E1%85%A9%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(Entity)%204baede46aea54d9e8dd03bfd1914be3e.md)ë¥¼ ì´ìš©í•´ ëŒ“ê¸€ ìˆ˜ì •

**ì‚­ì œ**

1. ëŒ“ê¸€ ì¡°íšŒ ë¡œì§ì„ í†µí•´ ë„ì–´ì¤€ ëŒ“ê¸€ ëª©ë¡ ë¦¬ìŠ¤íŠ¸ì˜ **â€˜Xâ€™ ë²„íŠ¼(ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼)** í´ë¦­
2. Footer ì˜ `<script src="/js/app.js"></script>` ë¥¼ í†µí•´ [app.js](JavaScript%20%E1%84%8B%E1%85%AA%20%E1%84%8B%E1%85%B2%E1%84%92%E1%85%AD%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%80%E1%85%A5%E1%86%B7%E1%84%89%E1%85%A1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(app%20js)%20a7aa307c3044477393d4dd2cf4e80303.md) ì ‘ê·¼í•˜ê³ 
[app.js](JavaScript%20%E1%84%8B%E1%85%AA%20%E1%84%8B%E1%85%B2%E1%84%92%E1%85%AD%E1%84%89%E1%85%A5%E1%86%BC%20%E1%84%80%E1%85%A5%E1%86%B7%E1%84%89%E1%85%A1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%85%E1%85%A7%E1%86%AB(app%20js)%20a7aa307c3044477393d4dd2cf4e80303.md) ì˜ í´ë¦­ ì´ë²¤íŠ¸ ë©”ì„œë“œë¥¼ ì‘ì„±ì ë³¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•œ í›„ ì„¤ì •ëœ ì´ë™ ì£¼ì†Œë¡œ ì´ë™
    
    ![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%206.png)
    
3.  CommentApiController ì—ì„œ í•´ë‹¹ ì£¼ì†Œë¡œ ë§¤í•‘ëœ ë©”ì„œë“œê°€ ì‹¤í–‰ ë˜ì–´ 
CommentService ì˜ ë©”ì„œë“œ í˜¸ì¶œ
4. CommentService ì—ì„œëŠ” commentRepository ì— ì§ì ‘ ìƒì„±í•œ ë©”ì„œë“œë¥¼ í†µí•´ comment ê°ì²´ ì •ë³´ë¥¼ ë°›ì•„ì˜¤ê³  ë‹¤ì‹œ commentRepository ì˜ JpaRepository ìƒì† ë©”ì„œë“œë¥¼ í†µí•´ ì‚­ì œ.

---

### comment/list.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:fragment="list">
<!-- Comments -->
<div class="card">
    <div class="card-header bi bi-chat-dots" >
        <span th:if="${comments}" th:text="${comments.size}">
        </span> Comments

    </div>
    <!-- ëŒ“ê¸€ë‚´ìš© ë¶€ë¶„ -->
    <ul class="list-group-flush">
        <li th:each="comment : ${comments}" th:id="'comments-' + ${comment.id}" class="list-group-item">
            <span>
                <span style="font-size: small" th:text="${comment.nickname}"></span>
                <span style="font-size: xx-small" th:text="${comment.createdDate}"></span>
            </span>
            <span th:if="${isWriter}" >
                <a type="button" data-toggle="collapse" th:data-target="'.multi-collapse-' + ${comment.id}"
                   class="bi bi-pencil-square"></a> <!-- ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼ -->
                <a type="button" th:onclick="'main.commentDelete(' + ${posts.id} + ',' + ${comment.id} + ',' + ${comment.userId} + ',' + ${sessionId} + ')'"
                   class="bi bi-x-square"></a> <!-- ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ -->
            </span>

            <!-- ëŒ“ê¸€ ë‚´ìš© ë³´ê¸° -->
            <p th:class="'collapse multi-collapse-'+${comment.id}+' show'" th:text="${comment.comment}"></p>

            <!-- ëŒ“ê¸€ ë‚´ìš© ìˆ˜ì • -->
            <form th:class="'collapse multi-collapse-'+${comment.id}">
                <input type="hidden" th:id="'id'" th:value="${comment.id}">
                <input type="hidden" th:id="'postsId'" th:value="${posts.id}">
                <input type="hidden" th:id="'writerUserId'" th:value="${comment.userId}">
<!--                <input type="hidden" th:id="'sessionUserId'" th:value="${sessionUserId}">-->
                <input type="hidden" th:if="${user}" th:id="'sessionUserId'" th:value="${user.id}">
                <div class="form-group">
                    <textarea class="form-control" th:id="'comment-content'" rows="3" th:text="${comment.comment}"></textarea>
                </div>
                <button type="button" id="btn-comment-update" class="btn btn-outline-primary bi bi-pencil-square"> ìˆ˜ì •</button>
            </form>
        </li>
    </ul>
</div>
<br/>
</html>

```

<aside>
ğŸ’¡ Bootstrapì˜ `collapse` ê¸°ëŠ¥

![Untitled](%5BComment%5D%E1%84%83%E1%85%A2%E1%86%BA%E1%84%80%E1%85%B3%E1%86%AF%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20+%20%E1%84%89%E1%85%AE%E1%84%8C%E1%85%A5%E1%86%BC%20%E1%84%89%E1%85%A1%E1%86%A8%E1%84%8C%E1%85%A6%20%E1%84%8C%E1%85%A6%E1%84%92%E1%85%A1%E1%86%AB%2021f0668fb2c44907beadcfa9d6f4bbc4/Untitled%207.png)

Bootstrap ì—ì„œ ì‚¬ìš©ìê°€ í´ë¦­í•  ë•Œ ì»¨í…ì¸ ë¥¼ ìˆ¨ê¸°ê±°ë‚˜ í‘œì‹œí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ìœ¼ë¡œ ìˆ¨ê¸°ê±°ë‚˜ í‘œì‹œí•  ìš”ì†Œì— `class="collapse ~ â€` ë¥¼ ì¶”ê°€í•´ `collapse` ì ìš©.

</aside>

### comment/form.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:fragment="form">
<div class="card">
    <div class="card-header bi bi-chat-right-dots"> Write a Comment</div>
    <!-- ëŒ“ê¸€ì‘ì„± ë¶€ë¶„ -->
    <form>
        <input type="hidden" th:id="postsId" th:value="${posts.id}">
        <div th:if="${user}" class="card-body">
            <textarea id="comment" class="form-control" rows="4" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <div th:if="${user}" class="card-footer">
            <button type="button" id="btn-comment-save" class="btn btn-outline-primary bi bi-pencil-square"> ë“±ë¡</button>
        </div>
        <div th:unless="${user}" class="card-body" style="font-size: small">
            <a th:href="@{/auth/login}">ë¡œê·¸ì¸</a>ì„ í•˜ì‹œë©´ ëŒ“ê¸€ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
    </form>
</div>
</html>

```

---

### CommentApiController.java

ëŒ“ê¸€ ê´€ë ¨ ì‹¤ì œ API ê´€ë ¨ ì»¨íŠ¸ë¡¤ëŸ¬

```java
@RequiredArgsConstructor
@RequestMapping("/api")
@RestController
@Slf4j
public class CommentApiController {
    private final CommentService commentService;

   ...

    /* UPDATE */
    @PutMapping({"/posts/{postsId}/comments/{id}"})
    public ResponseEntity<Long> update(@PathVariable("postsId")Long postsId, @PathVariable("id")Long id, @RequestBody CommentDto.Request dto) {
        log.info("==========updateì „==========");
        log.info("postsId="+postsId +", id="+id+", dto="+dto);
        commentService.update(postsId, id, dto);
        log.info("==========updateí›„==========");

        return ResponseEntity.ok(id);
    }

    /* DELETE */
    @DeleteMapping("/posts/{postId}/comments/{id}")
    public ResponseEntity<Long> delete(@PathVariable("postId") Long postsId, @PathVariable("id") Long id) {
        commentService.delete(postsId, id);
        return ResponseEntity.ok(id);
    }
}
```

- `update()`
: ê²Œì‹œê¸€ ê³¼ ëŒ“ê¸€ì˜ `id`ë¥¼ ê²½ë¡œ ë³€ìˆ˜ë¡œ ë°›ì•„ì™€ `CommentDto` ì™€ í•¨ê»˜ 
ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œ í˜¸ì¶œ
    
    <aside>
    ğŸ’¡ **`@RequestBody`** ë€?
    HTTP Request ë³¸ë¬¸ì„ ì½ì–´ì™€ì„œ, ì§€ì •ëœ ìë°” ê°ì²´ë¡œ ë³€í™˜í•´ì£¼ëŠ” ì—­í• . `HttpMessageConverter`ë¥¼ í†µí•´ ì‘ì—…ì´ ì´ë¤„ì§€ë©° SpringBoot ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬  JSON ë°ì´í„°ë¥¼ ìë°” ê°ì²´ë¡œ ë³€í™˜í•´ ì¤€ë‹¤.
    
    </aside>
    
- `delete()`
: ê²Œì‹œê¸€ ê³¼ ëŒ“ê¸€ì˜ `id`ë¥¼ ê²½ë¡œ ë³€ìˆ˜ë¡œ ë°›ì•„ì™€ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œ í˜¸ì¶œ

---

### CommentService.java

ì´ë¦„ìœ¼ë¡œ Userê°ì²´ë¥¼ ì°¾ì•„ ê²Œì‹œë¬¼(Posts) Dto ì˜ ì—”í‹°í‹°ë¡œ ë°”ê¿”ì¤€ë’¤ Repository ì—ì„œ ì—”í‹°í‹° ì €ì¥

```java
@RequiredArgsConstructor
@Service
public class CommentService {

    private final CommentRepository commentRepository;
    private final UserRepository userRepository;
    private final PostsRepository postsRepository;

   ...

    /* UPDATE */
    @Transactional
    public void update(Long postId, Long id, CommentDto.Request dto) {
        Comment comment = commentRepository.findByPostsIdAndId(postId, id).orElseThrow(() ->
                new IllegalArgumentException("í•´ë‹¹ ëŒ“ê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤." + id));
        comment.update(dto.getComment());
    }

    /* DELETE */
    public void delete(Long postId, Long id) {
        Comment comment = commentRepository.findByPostsIdAndId(postId, id).orElseThrow(() ->
                new IllegalArgumentException("í•´ë‹¹ ëŒ“ê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. id=" + id));

        commentRepository.delete(comment);
    }
}

```

- `update()` / `delete()`
: ë‘ ë©”ì„œë“œ ëª¨ë‘ CommentRepository ì˜ ì§ì ‘ ìƒì„±í•œ `findByPostsIdAndId` ë©”ì„œë“œë¥¼ ì´ìš©í•˜ëŠ”ë° ê³µí†µì ì´ ìˆìŒ. í•˜ì§€ë§Œ `update()` ëŠ” `Comment` ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¡œ,  `delete()` ëŠ” commentRepository ì˜ JpaRepository ë¡œë¶€í„° ìƒì† ë°›ì€ ê¸°ë³¸ ë©”ì„œë“œë¡œ ì ‘ê·¼í•˜ëŠ”ë° ìˆì–´ ì°¨ì´ê°€ ìˆë‹¤.

### CommentRepository.java

`JpaRepository<Comment, Long>` ë¥¼ ìƒì†ë°›ì•„ ê¸°ë³¸ì ì¸ CRUD ê´€ë ¨ ë©”ì„œë“œëŠ” ì œê³µì„ í•œë‹¤.

```java
public interface CommentRepository extends JpaRepository<Comment, Long> {
    /* ê²Œì‹œê¸€ ëŒ“ê¸€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° */

    Optional<Comment> findByPostsIdAndId(Long postId, Long id);
}
```

- `Optional<Comment> findByPostsIdAndId(Long postId, Long id);`
: Spring Data JPA ë¥¼ í†µí•´ ìƒì„±í•œ ë©”ì„œë“œì˜ ì´ë¦„ì„ ë¶„ì„í•˜ì—¬ JPQL ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±

---